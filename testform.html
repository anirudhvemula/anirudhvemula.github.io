<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Formspree + reCAPTCHA v3 Test</title>
</head>
<body>
  <h1>Formspree + reCAPTCHA v3 Test</h1>

  <form action="https://formspree.io/f/mnnzkyoa" method="POST" id="contact" novalidate>
    <label>Email:
      <input name="email" type="email" required value="test@example.com">
    </label>
    <br><br>

    <label>Message:
      <textarea name="message" required>Test message from v3 demo</textarea>
    </label>
    <br><br>

    <!-- Honeypot field -->
    <input type="text" name="_honey" style="display:none" tabindex="-1" autocomplete="off">

    <!-- reCAPTCHA token will be injected here -->
    <input type="hidden" name="g-recaptcha-response" id="g-recaptcha-response">

    <button type="submit" id="submitBtn">Send</button>
  </form>

  <p id="form-status" role="status" aria-live="polite"></p>

  <!-- Load reCAPTCHA v3 script -->
  <script src="https://www.google.com/recaptcha/api.js?render=6LcQgK0rAAAAANXIYAA6zvNHpBszHnkLevSMzpYJ"></script>

  <script>
    const form = document.getElementById('contact');
    const statusEl = document.getElementById('form-status');
    const btn = document.getElementById('submitBtn');

    form.addEventListener('submit', function (e) {
      e.preventDefault();
      btn.disabled = true;
      statusEl.textContent = 'Verifying reCAPTCHA…';

      grecaptcha.ready(function () {
        grecaptcha.execute('6LcQgK0rAAAAANXIYAA6zvNHpBszHnkLevSMzpYJ', { action: 'contact_form' })
          .then(async function (token) {
            if (!token) {
              statusEl.textContent = 'No reCAPTCHA token generated (check site key/domain).';
              btn.disabled = false;
              return;
            }

            document.getElementById('g-recaptcha-response').value = token;

            statusEl.textContent = 'Sending to Formspree…';
            try {
              const res = await fetch(form.action, {
                method: 'POST',
                body: new FormData(form),
                headers: { 'Accept': 'application/json' }
              });

              if (res.ok) {
                form.reset();
                statusEl.textContent = '✅ Success! Your message was sent.';
              } else {
                const data = await res.json().catch(() => ({}));
                statusEl.textContent =
                  data.errors ? data.errors.map(e => e.message).join(', ')
                              : `❌ Error ${res.status}`;
              }
            } catch (err) {
              statusEl.textContent = '❌ Network/CORS blocked. Check CSP, ad blockers, or Allowed Domains.';
            } finally {
              btn.disabled = false;
            }
          })
          .catch((err) => {
            console.error('reCAPTCHA error:', err);
            statusEl.textContent = '❌ reCAPTCHA execution failed (wrong key or blocked).';
            btn.disabled = false;
          });
      });
    });
  </script>
</body>
</html>
